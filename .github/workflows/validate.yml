name: Validate Configuration

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  validate:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'
    
    - name: Validate JSON Configuration
      run: |
        echo "Validating streamdeck-config-generator.json..."
        python3 -m json.tool streamdeck-config-generator.json > /dev/null
        if [ $? -eq 0 ]; then
          echo "âœ… JSON is valid!"
        else
          echo "âŒ JSON is invalid!"
          exit 1
        fi
    
    - name: Check for Required Files
      run: |
        echo "Checking for required files..."
        files=(
          "README.md"
          "streamdeck-config-generator.json"
          "streamdeck-setup-step-by-step.txt"
          "streamdeck-cheatsheet.html"
          "generate_streamdeck_config.py"
        )
        
        for file in "${files[@]}"; do
          if [ -f "$file" ]; then
            echo "âœ… Found: $file"
          else
            echo "âŒ Missing: $file"
            exit 1
          fi
        done
    
    - name: Test Configuration Generator Script
      run: |
        echo "Testing configuration generator..."
        python3 generate_streamdeck_config.py
        if [ $? -eq 0 ]; then
          echo "âœ… Script executed successfully!"
        else
          echo "âŒ Script failed!"
          exit 1
        fi
    
    - name: Validate All JSON Files
      run: |
        echo "Validating all JSON files..."
        for file in *.json; do
          echo "Checking $file..."
          python3 -m json.tool "$file" > /dev/null
          if [ $? -eq 0 ]; then
            echo "âœ… $file is valid"
          else
            echo "âŒ $file is invalid"
            exit 1
          fi
        done
    
    - name: Success Message
      run: |
        echo "ğŸ‰ All validations passed!"
        echo "âœ… JSON configuration is valid"
        echo "âœ… All required files present"
        echo "âœ… Scripts execute successfully"
